{% extends 'blog/base.html' %}

{% block title %}{{ article.title }} — Mon Blog{% endblock %}

{% block content %}
    <div class="article-full">
        <h1>{{ article.title }}</h1>
        <p class="article-meta">
            Par {{ article.author }} — {{ article.created_at|date:"d M Y à H:i" }}
            {% if article.category %}
                · <a href="{% url 'category_articles' article.category.slug %}" class="category-tag">{{ article.category }}</a>
            {% endif %}
        </p>

        {% if user == article.author %}
            <p class="article-actions">
                <a href="{% url 'article_edit' article.slug %}" class="btn">Modifier</a>
                <a href="{% url 'article_delete' article.slug %}" class="btn btn-danger">Supprimer</a>
            </p>
        {% endif %}

        <hr>
        <div>{{ article.content|linebreaks }}</div>
    </div>

    <div id="comments-section">
        <h3>Commentaires ({{ article.comments.count }})</h3>

        <div id="comments-list">
            {% for comment in article.comments.all %}
                <div class="comment">
                    <p class="comment-author">{{ comment.author }} · {{ comment.created_at|date:"d M Y à H:i" }}</p>
                    <p>{{ comment.content }}</p>
                </div>
            {% endfor %}
        </div>

        {% if user.is_authenticated %}
            <div class="article-full" style="margin-top: 1rem;">
                <h3>Ajouter un commentaire</h3>
                <form method="post"
                      hx-post="{% url 'add_comment' article.slug %}"
                      hx-target="#comments-section"
                      hx-swap="outerHTML"
                      hx-on::after-request="if(event.detail.successful) this.reset()">
                    {% csrf_token %}
                    {{ comment_form.content }}
                    <button type="submit" class="btn">Commenter</button>
                </form>
            </div>
        {% else %}
            <p class="form-link"><a href="{% url 'login' %}">Connectez-vous</a> pour commenter.</p>
        {% endif %}
    </div>
{% endblock %}
